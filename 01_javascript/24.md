<h1>Programa√ß√£o Ass√≠ncrona - Parte 03</h1>



Na primeira parte aprendemos a diferen√ßa entre Programa√ß√£o S√≠ncrona e Ass√≠ncrona e conhecemos a primeira forma de escrever fun√ß√µes ass√≠ncronas no TypeScript/JavaScript, chamada de **Callbacks**. Na segunda parte, conhecemos a segunda forma de escrever fun√ß√µes ass√≠ncronas chamada de **Promises**. Nesta terceira parte, vamos conhecer uma terceira forma de de escrever fun√ß√µes ass√≠ncronas chamada de **Async/Await**, que promete simplificar a forma de escrever **Promises**.

<br />

<h2>Async/Await</h2>



As palavras-chave **async** e **await**, √© uma sintaxe criada com objetivo de simplificar a programa√ß√£o ass√≠ncrona, facilitando o fluxo de escrita e leitura do c√≥digo. Em outras palavras, torna poss√≠vel escrever um c√≥digo que funciona de forma ass√≠ncrona, por√©m √© lido e estruturado de forma s√≠ncrona. O async/await tamb√©m trabalha com o c√≥digo ass√≠ncrono baseado em Promises, por√©m  esconde as promessas para que a leitura e a escrita sejam mais limpas.

Ao declarar uma fun√ß√£o com a palavra reservada **async**, n√≥s poderemos utilizar a palavra-chave **await** antes de qualquer fun√ß√£o que retorne uma promise. Dessa forma, a execu√ß√£o da fun√ß√£o externa (a fun√ß√£o async), ser√° pausada at√© que a Promise seja resolvida.

A palavra-chave **await** recebe uma Promise e a transforma em um valor de retorno (ou lan√ßa uma exce√ß√£o em caso de erro). Quando utilizamos o **await**, o TypeScript/JavaScript vai aguardar at√© que a Promise seja finalizada. Se for finalizada com sucesso (o termo utilizado √© *fulfilled*), o valor obtido √© retornado. Se a Promise for rejeitada (o termo utilizado √© *rejected*), √© retornado o erro lan√ßado pela exce√ß√£o. 

Em rela√ß√£o ao tratamento e erros, utilizaremos a estrutura **try-catch-finally** padr√£o do TypeScript/Javascript.

**Sintaxe:**

```ts
async function nome_da_funcao(){
    
   await funcao_retorna_promise();

}
```

Observe que a fun√ß√£o foi declarada com a palavra chave **async**, indicando que ela ser√° do tipo ass√≠ncrona. No corpo da fun√ß√£o, utilizaremos a palavra chave **await** para indicar que uma fun√ß√£o que retorna uma Promise ser√° executada. Importante refor√ßar que a palavra chave **await s√≥ pode ser utilizada em uma fun√ß√£o ass√≠ncrona**.

Para uma melhor compreens√£o, vamos reescrever o c√≥digo da nossa Sorveteria utilizando Async/Await!

<br />

<img src="https://i.imgur.com/8eYS3Y6.png" title="source: imgur.com" width="3%"/>**Projeto Sorveteria - Async/Await:**

Vamos come√ßar criando o objeto **estoque**, a vari√°vel boolean **sorveteriaAberta** para controlar se a Sorveteria est√° aberta e para finalizar, vamos criar duas fun√ß√µes ass√≠ncronas: **tempo()** e **sorveteria()**. A fun√ß√£o **tempo()** ter√° um par√¢metro do tipo number, chamado **tempoMs**, que receber√° um tempo em milissegundos. A implementa√ß√£o do c√≥digo voc√™ confere abaixo:

```ts
// Objeto que define o estoque da Sorveteria
let estoque = {
    Frutas: ["Morango", "Uva", "Banana", "Ma√ß√£"],
    Liquidos: ["Gelo", "√Ågua"],
    Suporte: ["Casquinha", "Pote", "Ta√ßa"],
    Toppings: ["Chocolate", "Castanha", "Granulado", "Pa√ßoca"],
};

// Vari√°vel de checagem se Sorveteria est√° aberta
let sorveteriaAberta = false;

// Fun√ß√£o que define o tempo de execu√ß√£o da tarefa
async function tempo(tempoMs: number){

}

// Fun√ß√£o sorveteria, que engloba pedidos e producao
async function sorveteria(){

}
 
 sorveteria(); 
```

Na sequ√™ncia, vamos implementar a fun√ß√£o **tempo()**:

```ts
// Fun√ß√£o que define o tempo de execu√ß√£o da tarefa
async function tempo(tempoMs: number){
    return new Promise( (resolve, reject) => {

        if(sorveteriaAberta){
           setTimeout(resolve, tempoMs);
        }
  
        else{
           reject(console.log("Sorveteria Fechada!"));
        }
      });
}
```

A fun√ß√£o **tempo()** substituir√° a fun√ß√£o **setTimeout()**. Desta forma, ao inv√©s de chamarmos a fun√ß√£o **setTimeout()** (fun√ß√£o muito extensa) para cada tarefa, chamaremos a fun√ß√£o **tempo()** (fun√ß√£o curta), passando o tempo em milissegundos como argumento, que ela se encarregar√° de gerenciar o tempo de execu√ß√£o de cada tarefa da produ√ß√£o, deixando o c√≥digo mais limpo.

Para finalizar, vamos implementar a fun√ß√£o **sorveteria()**:

```ts
// Fun√ß√£o sorveteria, que engloba pedidos e producao
async function sorveteria() {

    try {

        await tempo(2000);
        console.log(`A fruta ${estoque.Frutas[0]} foi selecionada`);

        await tempo(0);
        console.log('Produ√ß√£o iniciada!');

        await tempo(2000);
        console.log("Cortando as frutas...");

        await tempo(1000);
        console.log(`Adicionando ${estoque.Liquidos[0]} e ${estoque.Liquidos[1]} ...`);

        await tempo(1000);
        console.log("Ligando a m√°quina ...");

        await tempo(2000);
        console.log(`Inserindo o sorvete na(o) ${estoque.Suporte[1]} ...`);

        await tempo(3000);
        console.log(`Adicionando ${estoque.Toppings[0]} ...`);

        await tempo(2000);
        console.log("Servindo o Sorvete ...");

    }catch (error) {
        console.log("O Cliente desistiu do Pedido!");
    }
}
```

Observe que para cada tarefa, primeiro chamamos a fun√ß√£o **tempo()**, passando o tempo estabelecido para a conclus√£o da tarefa em milissegundos como argumento da fun√ß√£o e na sequ√™ncia exibimos a mensagem relacionada a tarefa. Caso ocorra algum erro, a estrutura **try...catch** se encarregar√° de tratar a exce√ß√£o. Note que como a fun√ß√£o **tempo()** retorna um Promisse, utilizamos a palavra reservada **await** na chamada da fun√ß√£o.

Abaixo, voc√™ confere a vers√£o final da implementa√ß√£o e o resultado do c√≥digo:


```ts
// Objeto que define o estoque da Sorveteria
let estoque = {
    Frutas: ["Morango", "Uva", "Banana", "Ma√ß√£"],
    Liquidos: ["Gelo", "√Ågua"],
    Suporte: ["Casquinha", "Pote", "Ta√ßa"],
    Toppings: ["Chocolate", "Castanha", "Granulado", "Pa√ßoca"],
};

// Vari√°vel de checagem se Sorveteria est√° aberta
let sorveteriaAberta = true;

// Fun√ß√£o que define o tempo de execu√ß√£o da tarefa
async function tempo(tempoMs: number) {
    return new Promise((resolve, reject) => {

        if (sorveteriaAberta) {
            setTimeout(resolve, tempoMs);
        }

        else {
            reject(console.log("Sorveteria Fechada!"));
        }
    });
}

// Fun√ß√£o sorveteria, que engloba pedidos e producao
async function sorveteria() {

    try {

        await tempo(2000);
        console.log(`A fruta ${estoque.Frutas[0]} foi selecionada`);

        await tempo(0);
        console.log('Produ√ß√£o iniciada!');

        await tempo(2000);
        console.log("Cortando as frutas...");

        await tempo(1000);
        console.log(`Adicionando ${estoque.Liquidos[0]} e ${estoque.Liquidos[1]} ...`);

        await tempo(1000);
        console.log("Ligando a m√°quina ...");

        await tempo(2000);
        console.log(`Inserindo o sorvete na(o) ${estoque.Suporte[1]} ...`);

        await tempo(3000);
        console.log(`Adicionando ${estoque.Toppings[0]} ...`);

        await tempo(2000);
        console.log("Servindo o Sorvete ...");

    }catch (error) {
        console.log("O Cliente desistiu do Pedido!");
    }
}

sorveteria(); 
```

<img src="https://i.imgur.com/V2ReOnx.png" title="source: imgur.com" width="3%"/>**Resultado do Algoritmo:**

```bash
A fruta Morango foi selecionada
Produ√ß√£o iniciada!
Cortando as frutas...
Adicionando Gelo e √Ågua ...
Ligando a m√°quina ...
Inserindo o sorvete na(o) Pote ...
Adicionando Chocolate ...
Servindo o Sorvete ...
```

Todas as tarefas foram executadas dentro dos tempos estabelecidos e o nosso c√≥digo ficou muito mais organizado e limpo.

<br />

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="5%"/> <a href="" target="_blank"><b>C√≥digo fonte dos exemplos</b></a></div>

<br />

------

## üîë**Pontos chave:**

1.   Um **Sistema S√≠ncrono**, todas as tarefas s√£o conclu√≠das uma ap√≥s a outra. Um bloco de c√≥digo sempre aguarda o bloco de c√≥digo anterior finalizar, para s√≥ ent√£o continuar a leitura do restante do c√≥digo.
2.   Um **Sistema Ass√≠ncrono**, as tarefas s√£o conclu√≠das de forma independente. Um bloco de c√≥digo nunca aguarda o bloco de c√≥digo anterior finalizar, para continuar a leitura do restante do c√≥digo, ou seja, os blocos de c√≥digo s√£o executados em paralelo.
3.   Uma fun√ß√£o **Callback** **√© uma fun√ß√£o passada como argumento de outra fun√ß√£o, que √© ent√£o invocada dentro da fun√ß√£o externa para completar algum tipo de rotina ou a√ß√£o**.
4.   **Promises** √© um padr√£o de desenvolvimento, representado por **um objeto TypeScript/JavaScript, que permite a execu√ß√£o de processamentos no formato ass√≠ncrono**.
5.   Uma Promise sempre ser√° uma a√ß√£o que ser√° executada no futuro, que pode ou n√£o ser bem sucedida, podendo  assumir v√°rios estados. Por isso s√£o chamadas de Promessas, porque na pr√°tica a fun√ß√£o "promete" trazer um retorno em algum momento no futuro, que pode ou n√£o ser bem sucedido.
6.   Uma Promise possui tr√™s estados: **Pendente (Pending)**, **Resolvido (Fulfilled)** e **Rejeitado (Rejected)**.
7.   As palavras-chave **async** e **await**, √© uma sintaxe criada com objetivo de simplificar a programa√ß√£o ass√≠ncrona, facilitando o fluxo de escrita e leitura do c√≥digo. Em outras palavras, torna poss√≠vel escrever um c√≥digo que funciona de forma ass√≠ncrona, por√©m √© lido e estruturado de forma s√≠ncrona.

<br />

<br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>